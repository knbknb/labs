---
title: "w3-03-modeling-variance"
author: "Knut Behrends"
date: "January 2, 2016"
output: html_document
---

## Models for Variance Exercises 


Install and load the following data library:
```{r}


#library(devtools)
#install_github("genomicsclass/tissuesGeneExpression")
library(tissuesGeneExpression)

```

Now load this data and select the columns related to endometrium: 

```{r}


data("tissuesGeneExpression") # 2 data frames "e" and "tab"
library(genefilter)
y = e[,which(tissue=="endometrium")]
rm(e)
dim(y)
```

This will give you a matrix y with 15 samples and 22200 genes.

### Models for Variance Exercises #1 (1 point possible)

Compute the across sample variance for the fifteen samples. Then make a qq-plot to see if the variances follow ae normal distribution.

```{r}


vars = sapply(1:nrow(y), function(i){var(y[i,]) })
qqnorm( vars)
qqline(vars)

```

Which statement is true? (pick one)

* ~~With the exception of a handful of outliers, the data follow a normal distribution.~~
* ~~The variance does not follow a normal distribution, but taking the square root fixes this.~~
* The normal distribution is not a useful approximation here: the left tail is over estimated and the right tail is underestimated.
* ~~The normal distribution fits the data almost perfectly.~~

```{r eval=FALSE}
#rafa's solution
library(genefilter)
s2 <- rowVars(y)
library(rafalib)
mypar(1,1)
qqnorm(s2)
qqline(s2)
##To see the square root transformation does not help much:
qqnorm(sqrt(s2))
qqline(sqrt(s2))

```

### Models for Variance Exercises #2 (1 point possible)

Now fit an F-distribution with 14 degrees of freedom using the fitFDist function in the limma package:

```{r}
library(limma)
estimates <- fitFDist(vars, 14)

```

What is estimated the estimated scale parameter?

```{r}
estimates$scale
```


### Models for Variance Exercises #3 (1 point possible)

Now create a qq-plot of the observed sample standard deviation versus the quantiles predicted by the F-distribution (remember to take square root).

```{r}
theoretical<- sqrt(qf((seq(0,nrow(y))+0.5)/nrow(y), 14, estimates$df2) * estimates$scale)
observed <- vars
qqplot(theoretical,observed)
abline(0,1)

```

Rafa's solution:

```{r}
s2 <- vars
ps <- (seq(along=s2)-0.5)/length(s2)

theoretical <- qf(ps,14,estimates$df2)*estimates$scale 
LIM <- sqrt( range(c(theoretical,s2)) )
mypar(1,2)
qqplot(sqrt( theoretical ), sqrt( s2 ),ylim=LIM,xlim=LIM)
abline(0,1)
##close up excluding the upper 5%
K <- sqrt( quantile(s2,0.95) )
qqplot( sqrt( theoretical ), sqrt( s2 ),ylim=c(0,K),xlim=c(0,K))
abline(0,1)

```

Which of the following best describes the qq-plot?

* ~~The fitted F-distribution provides a perfect fit.~~
* If we exclude the genes with the highest variances (top 5%), the F-distribution provides a good fit.
* ~~If we exclude the genes with the lowest variances (bottom 5%), the F-distribution provides a good fit.~~
* ~~The normal distribution provided a better fit.~~

